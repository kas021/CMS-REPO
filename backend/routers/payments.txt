from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from .. import crud, schemas
from ..database import get_db

router = APIRouter(
    prefix="/invoices", # Payments are nested under invoices
    tags=["Payments"],
)

@router.post("/{invoice_id}/payments", response_model=schemas.Payment)
def create_payment_for_invoice(invoice_id: int, payment: schemas.PaymentCreate, db: Session = Depends(get_db)):
    db_payment = crud.create_payment_for_invoice(db=db, invoice_id=invoice_id, payment=payment)
    if db_payment is None:
        raise HTTPException(status_code=404, detail="Invoice not found")
    return db_payment